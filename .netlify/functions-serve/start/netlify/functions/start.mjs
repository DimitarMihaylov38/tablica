
import {createRequire as ___nfyCreateRequire} from "module";
import {fileURLToPath as ___nfyFileURLToPath} from "url";
import {dirname as ___nfyPathDirname} from "path";
let __filename=___nfyFileURLToPath(import.meta.url);
let __dirname=___nfyPathDirname(___nfyFileURLToPath(import.meta.url));
let require=___nfyCreateRequire(import.meta.url);


// netlify/functions/start.js
import { getStore } from "@netlify/blobs";
import crypto from "crypto";
function randInt(min, max) {
  return Math.floor(Math.random() * (max - min + 1)) + min;
}
function makeQuestions({ count, min, max }) {
  const used = /* @__PURE__ */ new Set();
  const out = [];
  while (out.length < count) {
    const a = randInt(min, max);
    const b = randInt(min, max);
    const key = `${a}x${b}`;
    if (used.has(key)) continue;
    used.add(key);
    out.push({ a, b });
  }
  return out;
}
var start_default = async (req) => {
  if (req.method !== "POST") return new Response("Method Not Allowed", { status: 405 });
  const body = await req.json().catch(() => ({}));
  const count = Number(body.count ?? 20);
  const durationSec = Number(body.durationSec ?? 60);
  const min = Number(body.min ?? 2);
  const max = Number(body.max ?? 9);
  if (!Number.isFinite(count) || count <= 0 || count > 50) {
    return Response.json({ error: "Bad count" }, { status: 400 });
  }
  if (!Number.isFinite(durationSec) || durationSec < 10 || durationSec > 600) {
    return Response.json({ error: "Bad duration" }, { status: 400 });
  }
  if (!Number.isFinite(min) || !Number.isFinite(max) || min < 2 || max > 20 || min > max) {
    return Response.json({ error: "Bad range" }, { status: 400 });
  }
  const questions = makeQuestions({ count, min, max });
  const attemptId = crypto.randomUUID();
  const startedAt = Date.now();
  const store = getStore("times-table-2-9");
  await store.setJSON(
    `attempt:${attemptId}`,
    { questions, startedAt, durationSec, count },
    { ttl: 60 * 10 }
    // 10 мин
  );
  return Response.json({ attemptId, questions, durationSec, count });
};
export {
  start_default as default
};
//# sourceMappingURL=data:application/json;base64,ewogICJ2ZXJzaW9uIjogMywKICAic291cmNlcyI6IFsibmV0bGlmeS9mdW5jdGlvbnMvc3RhcnQuanMiXSwKICAic291cmNlc0NvbnRlbnQiOiBbImltcG9ydCB7IGdldFN0b3JlIH0gZnJvbSBcIkBuZXRsaWZ5L2Jsb2JzXCI7XHJcbmltcG9ydCBjcnlwdG8gZnJvbSBcImNyeXB0b1wiO1xyXG5cclxuZnVuY3Rpb24gcmFuZEludChtaW4sIG1heCkge1xyXG4gIHJldHVybiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAobWF4IC0gbWluICsgMSkpICsgbWluO1xyXG59XHJcblxyXG5mdW5jdGlvbiBtYWtlUXVlc3Rpb25zKHsgY291bnQsIG1pbiwgbWF4IH0pIHtcclxuICAvLyBcdTA0MjNcdTA0M0RcdTA0MzhcdTA0M0FcdTA0MzBcdTA0M0JcdTA0M0RcdTA0MzggXHUwNDM0XHUwNDMyXHUwNDNFXHUwNDM5XHUwNDNBXHUwNDM4IChhLGIpLiBcdTA0MUZcdTA0NDBcdTA0MzggMi4uOSBcdTA0MzhcdTA0M0NcdTA0MzAgNjQgXHUwNDMyXHUwNDRBXHUwNDM3XHUwNDNDXHUwNDNFXHUwNDM2XHUwNDNEXHUwNDNFXHUwNDQxXHUwNDQyXHUwNDM4LCBcdTA0MzRcdTA0M0VcdTA0NDFcdTA0NDJcdTA0MzBcdTA0NDJcdTA0NEFcdTA0NDdcdTA0M0RcdTA0M0UgXHUwNDM3XHUwNDMwIDIwLlxyXG4gIGNvbnN0IHVzZWQgPSBuZXcgU2V0KCk7XHJcbiAgY29uc3Qgb3V0ID0gW107XHJcblxyXG4gIHdoaWxlIChvdXQubGVuZ3RoIDwgY291bnQpIHtcclxuICAgIGNvbnN0IGEgPSByYW5kSW50KG1pbiwgbWF4KTtcclxuICAgIGNvbnN0IGIgPSByYW5kSW50KG1pbiwgbWF4KTtcclxuICAgIGNvbnN0IGtleSA9IGAke2F9eCR7Yn1gO1xyXG4gICAgaWYgKHVzZWQuaGFzKGtleSkpIGNvbnRpbnVlO1xyXG4gICAgdXNlZC5hZGQoa2V5KTtcclxuICAgIG91dC5wdXNoKHsgYSwgYiB9KTtcclxuICB9XHJcbiAgcmV0dXJuIG91dDtcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgYXN5bmMgKHJlcSkgPT4ge1xyXG4gIGlmIChyZXEubWV0aG9kICE9PSBcIlBPU1RcIikgcmV0dXJuIG5ldyBSZXNwb25zZShcIk1ldGhvZCBOb3QgQWxsb3dlZFwiLCB7IHN0YXR1czogNDA1IH0pO1xyXG5cclxuICBjb25zdCBib2R5ID0gYXdhaXQgcmVxLmpzb24oKS5jYXRjaCgoKSA9PiAoe30pKTtcclxuXHJcbiAgY29uc3QgY291bnQgPSBOdW1iZXIoYm9keS5jb3VudCA/PyAyMCk7XHJcbiAgY29uc3QgZHVyYXRpb25TZWMgPSBOdW1iZXIoYm9keS5kdXJhdGlvblNlYyA/PyA2MCk7XHJcblxyXG4gIC8vIFx1MDQzRlx1MDQzRSBcdTA0NDJcdTA0MzJcdTA0M0VcdTA0NEZcdTA0NDJcdTA0MzAgXHUwNDNCXHUwNDNFXHUwNDMzXHUwNDM4XHUwNDNBXHUwNDMwOiBcdTA0M0NcdTA0MzBcdTA0NDVcdTA0MzBcdTA0M0NcdTA0MzUgXHUwNDMyXHUwNDQxXHUwNDM4XHUwNDQ3XHUwNDNBXHUwNDM4IFx1MDQzN1x1MDQzMFx1MDQzNFx1MDQzMFx1MDQ0N1x1MDQzOCBcdTA0NDEgMSA9PiBtaW49MiBtYXg9OVxyXG4gIGNvbnN0IG1pbiA9IE51bWJlcihib2R5Lm1pbiA/PyAyKTtcclxuICBjb25zdCBtYXggPSBOdW1iZXIoYm9keS5tYXggPz8gOSk7XHJcblxyXG4gIGlmICghTnVtYmVyLmlzRmluaXRlKGNvdW50KSB8fCBjb3VudCA8PSAwIHx8IGNvdW50ID4gNTApIHtcclxuICAgIHJldHVybiBSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiQmFkIGNvdW50XCIgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICB9XHJcbiAgaWYgKCFOdW1iZXIuaXNGaW5pdGUoZHVyYXRpb25TZWMpIHx8IGR1cmF0aW9uU2VjIDwgMTAgfHwgZHVyYXRpb25TZWMgPiA2MDApIHtcclxuICAgIHJldHVybiBSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiQmFkIGR1cmF0aW9uXCIgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICB9XHJcbiAgaWYgKCFOdW1iZXIuaXNGaW5pdGUobWluKSB8fCAhTnVtYmVyLmlzRmluaXRlKG1heCkgfHwgbWluIDwgMiB8fCBtYXggPiAyMCB8fCBtaW4gPiBtYXgpIHtcclxuICAgIHJldHVybiBSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiQmFkIHJhbmdlXCIgfSwgeyBzdGF0dXM6IDQwMCB9KTtcclxuICB9XHJcblxyXG4gIGNvbnN0IHF1ZXN0aW9ucyA9IG1ha2VRdWVzdGlvbnMoeyBjb3VudCwgbWluLCBtYXggfSk7XHJcbiAgY29uc3QgYXR0ZW1wdElkID0gY3J5cHRvLnJhbmRvbVVVSUQoKTtcclxuICBjb25zdCBzdGFydGVkQXQgPSBEYXRlLm5vdygpO1xyXG5cclxuICBjb25zdCBzdG9yZSA9IGdldFN0b3JlKFwidGltZXMtdGFibGUtMi05XCIpO1xyXG4gIGF3YWl0IHN0b3JlLnNldEpTT04oXHJcbiAgICBgYXR0ZW1wdDoke2F0dGVtcHRJZH1gLFxyXG4gICAgeyBxdWVzdGlvbnMsIHN0YXJ0ZWRBdCwgZHVyYXRpb25TZWMsIGNvdW50IH0sXHJcbiAgICB7IHR0bDogNjAgKiAxMCB9IC8vIDEwIFx1MDQzQ1x1MDQzOFx1MDQzRFxyXG4gICk7XHJcblxyXG4gIHJldHVybiBSZXNwb25zZS5qc29uKHsgYXR0ZW1wdElkLCBxdWVzdGlvbnMsIGR1cmF0aW9uU2VjLCBjb3VudCB9KTtcclxufTtcclxuXHJcbiJdLAogICJtYXBwaW5ncyI6ICI7Ozs7Ozs7Ozs7QUFBQSxTQUFTLGdCQUFnQjtBQUN6QixPQUFPLFlBQVk7QUFFbkIsU0FBUyxRQUFRLEtBQUssS0FBSztBQUN6QixTQUFPLEtBQUssTUFBTSxLQUFLLE9BQU8sS0FBSyxNQUFNLE1BQU0sRUFBRSxJQUFJO0FBQ3ZEO0FBRUEsU0FBUyxjQUFjLEVBQUUsT0FBTyxLQUFLLElBQUksR0FBRztBQUUxQyxRQUFNLE9BQU8sb0JBQUksSUFBSTtBQUNyQixRQUFNLE1BQU0sQ0FBQztBQUViLFNBQU8sSUFBSSxTQUFTLE9BQU87QUFDekIsVUFBTSxJQUFJLFFBQVEsS0FBSyxHQUFHO0FBQzFCLFVBQU0sSUFBSSxRQUFRLEtBQUssR0FBRztBQUMxQixVQUFNLE1BQU0sR0FBRyxDQUFDLElBQUksQ0FBQztBQUNyQixRQUFJLEtBQUssSUFBSSxHQUFHLEVBQUc7QUFDbkIsU0FBSyxJQUFJLEdBQUc7QUFDWixRQUFJLEtBQUssRUFBRSxHQUFHLEVBQUUsQ0FBQztBQUFBLEVBQ25CO0FBQ0EsU0FBTztBQUNUO0FBRUEsSUFBTyxnQkFBUSxPQUFPLFFBQVE7QUFDNUIsTUFBSSxJQUFJLFdBQVcsT0FBUSxRQUFPLElBQUksU0FBUyxzQkFBc0IsRUFBRSxRQUFRLElBQUksQ0FBQztBQUVwRixRQUFNLE9BQU8sTUFBTSxJQUFJLEtBQUssRUFBRSxNQUFNLE9BQU8sQ0FBQyxFQUFFO0FBRTlDLFFBQU0sUUFBUSxPQUFPLEtBQUssU0FBUyxFQUFFO0FBQ3JDLFFBQU0sY0FBYyxPQUFPLEtBQUssZUFBZSxFQUFFO0FBR2pELFFBQU0sTUFBTSxPQUFPLEtBQUssT0FBTyxDQUFDO0FBQ2hDLFFBQU0sTUFBTSxPQUFPLEtBQUssT0FBTyxDQUFDO0FBRWhDLE1BQUksQ0FBQyxPQUFPLFNBQVMsS0FBSyxLQUFLLFNBQVMsS0FBSyxRQUFRLElBQUk7QUFDdkQsV0FBTyxTQUFTLEtBQUssRUFBRSxPQUFPLFlBQVksR0FBRyxFQUFFLFFBQVEsSUFBSSxDQUFDO0FBQUEsRUFDOUQ7QUFDQSxNQUFJLENBQUMsT0FBTyxTQUFTLFdBQVcsS0FBSyxjQUFjLE1BQU0sY0FBYyxLQUFLO0FBQzFFLFdBQU8sU0FBUyxLQUFLLEVBQUUsT0FBTyxlQUFlLEdBQUcsRUFBRSxRQUFRLElBQUksQ0FBQztBQUFBLEVBQ2pFO0FBQ0EsTUFBSSxDQUFDLE9BQU8sU0FBUyxHQUFHLEtBQUssQ0FBQyxPQUFPLFNBQVMsR0FBRyxLQUFLLE1BQU0sS0FBSyxNQUFNLE1BQU0sTUFBTSxLQUFLO0FBQ3RGLFdBQU8sU0FBUyxLQUFLLEVBQUUsT0FBTyxZQUFZLEdBQUcsRUFBRSxRQUFRLElBQUksQ0FBQztBQUFBLEVBQzlEO0FBRUEsUUFBTSxZQUFZLGNBQWMsRUFBRSxPQUFPLEtBQUssSUFBSSxDQUFDO0FBQ25ELFFBQU0sWUFBWSxPQUFPLFdBQVc7QUFDcEMsUUFBTSxZQUFZLEtBQUssSUFBSTtBQUUzQixRQUFNLFFBQVEsU0FBUyxpQkFBaUI7QUFDeEMsUUFBTSxNQUFNO0FBQUEsSUFDVixXQUFXLFNBQVM7QUFBQSxJQUNwQixFQUFFLFdBQVcsV0FBVyxhQUFhLE1BQU07QUFBQSxJQUMzQyxFQUFFLEtBQUssS0FBSyxHQUFHO0FBQUE7QUFBQSxFQUNqQjtBQUVBLFNBQU8sU0FBUyxLQUFLLEVBQUUsV0FBVyxXQUFXLGFBQWEsTUFBTSxDQUFDO0FBQ25FOyIsCiAgIm5hbWVzIjogW10KfQo=
